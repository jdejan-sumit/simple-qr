<ion-header>
  <ion-toolbar [color]="env.colorTheme === 'black'? 'black' : 'dark'">
    <!-- <ion-buttons slot="start">
      <ion-back-button defaultHref="scan" [icon]="'arrow-back'">
      </ion-back-button>
    </ion-buttons> -->
    <ion-title *ngIf="segmentModel === 'history'">{{ 'LOG' | translate }}</ion-title>
    <ion-title *ngIf="segmentModel === 'bookmarks'">{{ 'BOOKMARKS' | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-segment [(ngModel)]="segmentModel" (ionChange)="segmentChanged($event)" [color]="'primary'">
    <ion-segment-button [value]="'history'">
      <ion-icon src="assets/icon/history.svg"></ion-icon>
    </ion-segment-button>
    <ion-segment-button [value]="'bookmarks'">
      <ion-icon name="star"></ion-icon>
    </ion-segment-button>
  </ion-segment>
  <ng-container *ngIf="segmentModel === 'history' && firstLoad">
    <ion-list>
      <ng-container *ngFor="let _ of ['', '', '', '', '', '', '']; index as i">
        <ion-item class="ion-no-padding ripple-parent" detail="false" [lines]="'full'">
          <ion-label class="ion-padding-start">
            <div class="ion-padding">
              <p>
                <ion-text [color]="env.colorTheme === 'light'? 'dark' : 'light'" style="font-size: large;">
                  <ion-skeleton-text animated style="width: 100%"></ion-skeleton-text>
                </ion-text>
              </p>
              <p *ngIf="env.debugMode === 'on'">
                <ion-text color="medium">
                  <ion-skeleton-text animated style="width: 100%"></ion-skeleton-text>
                </ion-text>
              </p>
              <p>
                <ion-text color="medium">
                  <ion-skeleton-text animated style="width: 100%"></ion-skeleton-text>
                </ion-text>
              </p>
              <p>
                <ion-text color="medium">
                  <ion-skeleton-text animated style="width: 100%"></ion-skeleton-text>
                </ion-text>
              </p>
            </div>
          </ion-label>
        </ion-item>
      </ng-container>
    </ion-list>
  </ng-container>
  <ng-container *ngIf="segmentModel === 'history' && (!scanRecords || (scanRecords.length <= 0)) && !firstLoad">
    <div class="ion-padding-horizontal fullscreen-vertical-center" style="height: 85%">
      <ion-icon src="assets/icon/history.svg" [color]="env.colorTheme === 'light'? 'dark' : 'light'"
        style="font-size: 3rem"></ion-icon>
      <p class="ion-text-center pt-3">
        <ion-text [color]="env.colorTheme === 'light'? 'dark' : 'light'" style="font-size: large;">
          {{ 'SCANNING_RECORD_SHOWN' | translate }}
        </ion-text>
      </p>
    </div>
  </ng-container>
  <ng-container *ngIf="segmentModel === 'history' && scanRecords && scanRecords.length > 0 && !firstLoad">
    <ion-list>
      <ion-item-sliding *ngFor="let record of scanRecords; index as i" #slidingItem>
        <ion-item class="ion-no-padding ripple-parent" detail="false"
          [lines]="i === scanRecords.length - 1? 'none' : 'full'" (click)="processQrCode(record.text)">
          <ion-label class="ion-padding-start">
            <div class="ion-padding" style="overflow-x: clip; text-overflow: ellipsis;">
              <p>
                <ion-text [color]="env.colorTheme === 'light'? 'dark' : 'light'" style="font-size: large;">
                  {{ record.text }}
                </ion-text>
              </p>
              <p *ngIf="env.debugMode === 'on'">
                <ion-text color="medium">
                  {{ record.id }}
                </ion-text>
              </p>
              <p>
                <ion-text color="medium">
                  {{ maskDatetimeAndSource(record.createdAt, record.source) }}
                </ion-text>
              </p>
              <ion-badge *ngIf="record.barcodeType" class="my-1" color="primary">
                <div class="d-flex align-items-center">
                  <span>{{ getBarcodeFormat(record.barcodeType) }}</span>
                </div>
              </ion-badge>
            </div>
          </ion-label>
        </ion-item>
        <ion-item-options side="start">
          <ion-item-option [color]="'primary'" expandable (click)="addBookmark(record, slidingItem)">
            <ion-icon slot="icon-only" name="star"></ion-icon>
          </ion-item-option>
        </ion-item-options>
        <ion-item-options side="end">
          <ion-item-option color="danger" expandable (click)="removeRecord(record, slidingItem)">
            <ion-icon slot="icon-only" name="trash-bin"></ion-icon>
          </ion-item-option>
        </ion-item-options>
      </ion-item-sliding>
    </ion-list>
  </ng-container>
  <ng-container *ngIf="segmentModel === 'bookmarks' && (!bookmarks || (bookmarks.length <= 0))">
    <div class="ion-padding-horizontal fullscreen-vertical-center" style="height: 85%">
      <ion-icon name="star" [color]="env.colorTheme === 'light'? 'dark' : 'light'" style="font-size: 3rem"></ion-icon>
      <p class="ion-text-center pt-3">
        <ion-text [color]="env.colorTheme === 'light'? 'dark' : 'light'" style="font-size: large;">
          {{ 'FAVOURITE_TEXT_SHOWN' | translate }}
        </ion-text>
      </p>
    </div>
  </ng-container>
  <ng-container *ngIf="segmentModel === 'bookmarks' && bookmarks && bookmarks.length > 0">
    <ion-list>
      <ion-item-sliding *ngFor="let bookmark of bookmarks; index as i" #slidingItem>
        <ion-item class="ion-no-padding ripple-parent" detail="false"
          [lines]="i === bookmarks.length - 1? 'none' : 'full'" (click)="processQrCode(bookmark.text)">
          <ion-label class="ion-padding-start">
            <div class="ion-padding">
              <p style="overflow-x: clip; text-overflow: ellipsis;">
                <ion-text [color]="env.colorTheme === 'light'? 'dark' : 'light'" style="font-size: large;">
                  {{ bookmark.tag? bookmark.tag : '-' }}
                </ion-text>
              </p>
              <p>
                <ion-text [color]="'medium'">
                  {{ bookmark.text }}
                </ion-text>
              </p>
            </div>
          </ion-label>
        </ion-item>
        <ion-item-options side="start">
          <ion-item-option [color]="'primary'" expandable (click)="editBookmark(bookmark, slidingItem)">
            <ion-icon slot="icon-only" name="pencil"></ion-icon>
          </ion-item-option>
        </ion-item-options>
        <ion-item-options side="end">
          <ion-item-option color="danger" expandable (click)="removeBookmark(bookmark, slidingItem)">
            <ion-icon slot="icon-only" name="trash-bin"></ion-icon>
          </ion-item-option>
        </ion-item-options>
      </ion-item-sliding>
    </ion-list>
  </ng-container>

</ion-content>

<ion-footer
  [ngStyle]="env.colorTheme === 'dark'?  {'background-color': '#222428'} : (env.colorTheme === 'black'? {'background-color': '#000000'} : {'background-color': '#F0F0F0'})">
  <ion-row class="d-flex justify-content-around">
    <ion-button (click)="tapHaptic(); removeAll()" [color]="'danger'" fill="clear"
      *ngIf="(segmentModel === 'bookmarks' && bookmarks && bookmarks.length > 0) || (segmentModel === 'history' && scanRecords && scanRecords.length > 0)">
      {{ 'REMOVE_ALL' | translate }}
    </ion-button>
    <ion-button (click)="tapHaptic(); goSetting()" [color]="'primary'" fill="clear">
      {{ 'SETTING' | translate }}
    </ion-button>
  </ion-row>
</ion-footer>